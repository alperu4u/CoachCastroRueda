<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roster - Coach Castro Rueda</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAPEpoiMCgELVnRCLPYhpgMSpQeQLKMLA4",
      authDomain: "coach-castro-rueda.firebaseapp.com",
      projectId: "coach-castro-rueda",
      storageBucket: "coach-castro-rueda.firebasestorage.app",
      messagingSenderId: "685578915022",
      appId: "1:685578915022:web:64820ead8ed4a31b17149f",
      measurementId: "G-Y86PFCV9TE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function isBlank(player) {
      return !player.name && !player.number && !player.position;
    }

    window.addEventListener("DOMContentLoaded", async () => {
      const rosterBody = document.getElementById("roster-body");
      const playersRef = collection(db, "coach-castro-rueda");
      const snapshot = await getDocs(playersRef);

      const uniquePlayers = new Map();

      snapshot.forEach((docSnap) => {
        const player = docSnap.data();
        const key = `${player.name}|${player.number}`;
        if (!isBlank(player) && !uniquePlayers.has(key)) {
          uniquePlayers.set(key, { id: docSnap.id, ...player });
        }
      });

      const players = Array.from(uniquePlayers.values());
      players.sort((a, b) => Number(a.number) - Number(b.number));

      players.forEach((player) => {
        const row = document.createElement("tr");
        const fields = ["name", "number", "position", "agility", "speed", "passingL", "passingR", "dribbling", "shootingL", "shootingR", "soccerIQ", "attendance", "notes"];

        fields.forEach((field) => {
          const cell = document.createElement("td");

          if (field === "name") {
            const link = document.createElement("a");
            link.href = "#";
            link.textContent = player[field];
            link.style.color = "#D3BC8D";
            cell.appendChild(link);
          } else if (field === "notes") {
            const textarea = document.createElement("textarea");
            textarea.value = player[field] || "";
            textarea.rows = 1;
            textarea.style.width = "100px";
            textarea.title = player[field] || "";
            textarea.addEventListener("input", () => {
              textarea.title = textarea.value;
            });
            textarea.addEventListener("change", async () => {
              await updateDoc(doc(db, "coach-castro-rueda", player.id), {
                [field]: textarea.value
              });
            });
            cell.appendChild(textarea);
          } else {
            const input = document.createElement("input");
            input.type = field === "number" ? "number" : "text";
            input.value = player[field] || "";
            input.style.width = ["number", "position", "agility", "speed", "passingL", "passingR", "dribbling", "shootingL", "shootingR", "soccerIQ", "attendance"].includes(field) ? "60px" : "120px";
            input.addEventListener("change", async () => {
              await updateDoc(doc(db, "coach-castro-rueda", player.id), {
                [field]: input.value
              });
            });
            cell.appendChild(input);
          }

          row.appendChild(cell);
        });

        rosterBody.appendChild(row);
      });
    });
  </script>
</head>
<body>
  <div class="site-wrapper">
    <header>
      <h1>Coach Castro Rueda</h1>
      <nav>
        <ul>
          <li><a href="index.html">About</a></li>
          <li><a href="roster.html">Roster</a></li>
          <li><a href="conditioning-drills.html">Conditioning & Drills</a></li>
          <li><a href="Soccer-Drills.html">Soccer Drills</a></li>
          <li><a href="Contact-Coach.html">Contact</a></li>
        </ul>
      </nav>
    </header>

    <main class="roster" style="background-image: url('pictures/soccerfieldcartoon.png'); background-size: cover; background-position: center; padding: 2rem;">
      <section class="roster-table" style="background-color: rgba(0, 0, 0, 0.75); padding: 2rem; border-radius: 12px; color: white; max-width: 100%; overflow-x: auto;">
        <h2 style="text-align:center; margin-bottom: 1rem;">Team Roster</h2>
        <table style="width:100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th>Player</th>
              <th>#</th>
              <th>Position</th>
              <th>Agility</th>
              <th>Speed (20m)</th>
              <th>Passing (L)</th>
              <th>Passing (R)</th>
              <th>Dribbling</th>
              <th>Shooting (L)</th>
              <th>Shooting (R)</th>
              <th>Soccer IQ</th>
              <th>Attendance</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody id="roster-body">
            <!-- Firebase data loads here -->
          </tbody>
        </table>
      </section>
    </main>

    <footer>
      <p>&copy; 2025 Coach Castro Rueda. All rights reserved.</p>
    </footer>
  </div>
</body>
</html>

