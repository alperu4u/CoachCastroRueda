<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2025–26 Season Stats (Hidden)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Use your global site CSS -->
  <link rel="stylesheet" href="style.css" />

  <style>
    :root{
      --site-gold:#D3BC8D;
      --dark:#222;
      --card-bg: rgba(255,255,255,0.9);
      --shadow: 0 12px 24px rgba(0,0,0,0.15);
      --red:#c8102e;
      --blue:#0a4dd3;
    }
    body{
      background: var(--site-gold);
      margin:0;
      color:var(--dark);
    }

    /* Header / nav consistent with site */
    header.site-header {
      border-bottom: 3px solid #000;
      background: linear-gradient(90deg, var(--red) 0%, var(--blue) 100%);
      color:#fff;
      padding:12px 16px;
    }
    header .brand { font-weight:700; letter-spacing:0.5px; }
    nav.site-nav a{ color:#fff; text-decoration:none; margin-right:16px; font-weight:600; }
    nav.site-nav a:hover{ text-decoration:underline; }

    /* Banner hero */
    .season-hero{
      position:relative;
      min-height:260px;
      background: url('pictures/season-bg.png') center/cover no-repeat;
      border-bottom:3px solid #000;
      display:grid;
      place-items:center;
      text-align:center;
    }
    .season-hero::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,0.15), rgba(0,0,0,0.5));
    }
    .season-hero .title{
      position:relative; z-index:1;
      color:#fff;
      text-shadow:0 3px 10px rgba(0,0,0,0.4);
      padding:24px 16px;
    }
    .season-hero h1{ margin:0; font-size: clamp(24px, 3vw, 40px); }
    .season-hero p{ margin:6px 0 0; opacity:0.95; }

    /* Content wrapper */
    .container{
      max-width:1100px; margin:24px auto 64px; padding:0 16px;
    }

    /* Banner strip heading for list */
    .banner-strip{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 14px;
      background: linear-gradient(90deg, var(--red) 0%, var(--blue) 100%);
      color:#fff; border-radius:14px; box-shadow: var(--shadow);
      margin-bottom:14px;
    }
    .banner-strip .filters{
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .select, .search {
      background:#fff; border:1px solid #ddd; border-radius:10px; padding:8px 10px; color:#111;
      font-size:15px;
    }

    /* Stats list (cards) */
    .stats-list{
      display:grid; gap:12px;
    }
    .stat-card{
      background:var(--card-bg); border:1px solid rgba(0,0,0,0.08);
      border-radius:16px; box-shadow: var(--shadow); padding:14px;
      display:grid; grid-template-columns: 1fr auto; gap:8px 16px;
      align-items:center;
    }
    .stat-left{
      min-width:0;
    }
    .player-line{
      display:flex; gap:10px; align-items:baseline; flex-wrap:wrap;
    }
    .player-name{ font-size:18px; font-weight:800; }
    .player-number{
      background:#111; color:#fff; font-weight:800; border-radius:999px; padding:3px 8px; min-width:34px; text-align:center;
    }
    .metric-line{
      display:flex; flex-wrap:wrap; gap:10px 14px; margin-top:6px; font-size:14px;
    }
    .pill{
      background:#efefef; border:1px solid #ddd; border-radius:999px; padding:4px 10px; font-weight:600;
    }
    .stat-right{
      text-align:right; font-weight:800; font-size:18px;
    }
    .muted{ opacity:0.8; }
    footer.site-footer{
      border-top:3px solid #000; padding:24px 16px; text-align:center; background:#f3f3f3;
    }

    @media (max-width:720px){
      .stat-card{ grid-template-columns: 1fr; text-align:left; }
      .stat-right{ text-align:left; }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand">Coach Castro Rueda</div>
    <nav class="site-nav" aria-label="Main">
      <a href="index.html">Home</a>
      <a href="about-coach.html">About</a>
      <a href="roster.html">Roster</a>
      <a href="conditioning-drills.html">Conditioning</a>
      <a href="Soccer-Drills.html">Soccer Drills</a>
      <a href="Contact-Coach.html">Contact</a>
      <!-- Intentionally no nav link to this hidden page -->
    </nav>
  </header>

  <section class="season-hero" role="img" aria-label="Season banner background">
    <div class="title">
      <h1>2025–26 Season</h1>
      <p>Live team stats & focus areas (read from Google Sheets)</p>
    </div>
  </section>

  <main class="container">
    <div class="banner-strip">
      <div><strong>Season Stats</strong></div>
      <div class="filters">
        <input id="search" class="search" type="search" placeholder="Search player…" />
        <select id="sort" class="select" aria-label="Sort by">
          <option value="goals:desc">Goals (high → low)</option>
          <option value="assists:desc">Assists (high → low)</option>
          <option value="accuracy:desc">Pass Accuracy (high → low)</option>
          <option value="sot:desc">Shots On Target (high → low)</option>
          <option value="name:asc">Name (A → Z)</option>
        </select>
      </div>
    </div>

    <section id="stats" class="stats-list" aria-live="polite"></section>
    <p id="error" style="display:none; color:#b00020; font-weight:700; margin-top:16px;">
      Couldn’t load season stats. Make sure the sheet tab is <em>Published to the web</em> (File → Share → Publish to web).
    </p>
  </main>

  <footer class="site-footer">
    © <span id="year"></span> Coach Castro Rueda
  </footer>

  <script>
    // === Config ===
    const STATS_SHEET_ID = "1rPnlSN0b2wWV2FuHRaDkphsKhsGjD-rg83rfAcMLtGE";
    const STATS_GID = "0";

    // === Helpers ===
    function parseGViz(raw) {
      const start = raw.indexOf('(');
      const end = raw.lastIndexOf(')');
      return JSON.parse(raw.slice(start + 1, end));
    }
    function toRows(json) {
      const cols = json.table.cols.map(c => (c.label || c.id || "").trim());
      return json.table.rows.map(r => {
        const obj = {};
        r.c.forEach((cell, i) => {
          obj[cols[i] || ("Col" + i)] = cell ? (cell.v ?? cell.f ?? "") : "";
        });
        return obj;
      });
    }
    const n = (x) => {
      const v = Number(x);
      return Number.isFinite(v) ? v : 0;
    };
    function pct(num, den) {
      if (!den || n(den) === 0) return "—";
      return Math.round((n(num) / n(den)) * 100) + "%";
    }

    function sortRows(rows, sortKey) {
      const [key, dir] = sortKey.split(':');
      const mul = dir === 'desc' ? -1 : 1;

      return [...rows].sort((a,b) => {
        const av = (key === 'name') ? String(a["Name"] || "").toLowerCase()
                                    : (key === 'accuracy') ? (n(a["Completed Passes"]) && n(a["Attempted Passes"]) ? (n(a["Completed Passes"]) / Math.max(1, n(a["Attempted Passes"]))) : -1)
                                    : (key === 'sot') ? n(a["Shots-On-Target"])
                                    : (key === 'assists') ? n(a["Assists"])
                                    : (key === 'goals') ? n(a["Goals"])
                                    : 0;

        const bv = (key === 'name') ? String(b["Name"] || "").toLowerCase()
                                    : (key === 'accuracy') ? (n(b["Completed Passes"]) && n(b["Attempted Passes"]) ? (n(b["Completed Passes"]) / Math.max(1, n(b["Attempted Passes"]))) : -1)
                                    : (key === 'sot') ? n(b["Shots-On-Target"])
                                    : (key === 'assists') ? n(b["Assists"])
                                    : (key === 'goals') ? n(b["Goals"])
                                    : 0;

        if (av < bv) return -1 * mul;
        if (av > bv) return  1 * mul;
        return 0;
      });
    }

    function pill(label, value) {
      if (value === "" || value === null || typeof value === "undefined") return "";
      return `<span class="pill"><strong>${label}:</strong> ${value}</span>`;
    }

    function renderStats(rows) {
      const q = document.getElementById('search').value.trim().toLowerCase();
      const sortVal = document.getElementById('sort').value;

      // Filter
      let filtered = rows.filter(r => {
        const name = String(r["Name"] || "").toLowerCase();
        const number = String(r["Number"] || "");
        return !q || name.includes(q) || number.includes(q);
      });

      // Prepare derived field
      filtered = filtered.map(r => {
        const completed = n(r["Completed Passes"]);
        const attempted = n(r["Attempted Passes"]);
        return {
          ...r,
          __accuracy: pct(completed, attempted)
        };
      });

      // Sort
      filtered = sortRows(filtered, sortVal);

      // Render
      const box = document.getElementById('stats');
      box.innerHTML = "";

      filtered.forEach(r => {
        const name   = r["Name"] || "Unnamed";
        const number = r["Number"] || "—";
        const goals  = n(r["Goals"]);
        const ast    = n(r["Assists"]);
        const saves  = n(r["Saves"]);
        const sot    = n(r["Shots-On-Target"]);
        const games  = n(r["Games Played"]);
        const acc    = r.__accuracy;

        const card = document.createElement('article');
        card.className = "stat-card";
        card.innerHTML = `
          <div class="stat-left">
            <div class="player-line">
              <span class="player-name">${name}</span>
              <span class="player-number">#${number}</span>
            </div>
            <div class="metric-line">
              ${pill("Goals", goals)}
              ${pill("Assists", ast)}
              ${pill("Shots On Target", sot)}
              ${pill("Saves", saves)}
              ${pill("Games", games)}
              ${pill("Pass Acc", acc)}
            </div>
          </div>
          <div class="stat-right">
            <div>Goals <span class="muted">|</span> ${goals}</div>
            <div>Pass Acc <span class="muted">|</span> ${acc}</div>
          </div>
        `;
        box.appendChild(card);
      });
    }

    async function loadStats() {
      const url = `https://docs.google.com/spreadsheets/d/${STATS_SHEET_ID}/gviz/tq?tqx=out:json&gid=${STATS_GID}`;
      try {
        const raw = await fetch(url).then(r => r.text());
        const json = parseGViz(raw);
        const rows = toRows(json);
        renderStats(rows);
      } catch (e) {
        console.error(e);
        document.getElementById('error').style.display = "block";
      }
    }

    document.getElementById('search').addEventListener('input', loadStats);
    document.getElementById('sort').addEventListener('change', loadStats);
    document.getElementById('year').textContent = new Date().getFullYear();

    loadStats();
  </script>
</body>
</html>

